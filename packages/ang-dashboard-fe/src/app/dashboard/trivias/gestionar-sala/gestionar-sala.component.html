<!-- eslint-disable @angular-eslint/template/elements-content -->
<div class="container p-4">
  <!-- Spinner de carga inicial -->
  <p-progressSpinner *ngIf="loading" class="mb-4"></p-progressSpinner>

  <!-- Contenido principal -->
  <div *ngIf="!loading && trivia">
    <!-- Tarjeta principal -->
    <p-card class="mb-4">
      <ng-template pTemplate="header">
        <h2 class="text-2xl font-bold">{{ trivia.title }}</h2>
      </ng-template>

      <div class="grid grid-cols-2 gap-4 mb-6">
        <!-- Estado de la Sala -->
        <div>
          <p class="text-sm text-gray-600">Estado de la Sala</p>
          <p-tag
            *ngIf="roomState?.isActive"
            value=" Activa"
            severity="success"
          ></p-tag>
          <p-tag
            *ngIf="!roomState?.isActive"
            value=" Inactiva"
            severity="danger"
          ></p-tag>
        </div>

        <!-- Estado del Juego -->
        <div>
          <p class="text-sm text-gray-600">Estado del Juego</p>
          <p-tag
            *ngIf="roomState?.gameStarted"
            value=" En Progreso"
            severity="info"
          ></p-tag>
          <p-tag
            *ngIf="!roomState?.gameStarted"
            value="革 Detenido"
            severity="warn"
          ></p-tag>
        </div>

        <!-- Room ID -->
        <div>
          <p class="text-sm text-gray-600">ID de la Sala</p>
          <p class="text-lg font-bold">{{ roomId }}</p>
        </div>

        <!-- Contador de Jugadores -->
        <div>
          <p class="text-sm text-gray-600">Jugadores Conectados</p>
          <p class="text-lg font-bold">{{ playersCount }}/10</p>
        </div>

        <!-- Total de Preguntas -->
        <div>
          <p class="text-sm text-gray-600">Total de Preguntas</p>
          <p class="text-lg font-bold">{{ trivia.questions?.length || 0 }}</p>
        </div>

        <!-- Ronda Actual -->
        <div>
          <p class="text-sm text-gray-600">Ronda Actual</p>
          <p class="text-lg font-bold">{{ roomState?.round || 0 }}</p>
        </div>
      </div>

      <!-- Botones de Control -->
      <div class="flex gap-2 mb-6 flex-wrap">
        <!-- Bot贸n Activar/Desactivar -->
        <button
          (click)="toggleRoomActivation()"
          [disabled]="isActivating || !roomState"
          pButton
          type="button"
          [label]="roomState?.isActive ? ' Desactivar Sala' : ' Activar Sala'"
          [class]="roomState?.isActive ? 'p-button-danger' : 'p-button-success'"
          [loading]="isActivating"
        ></button>

        <!-- Bot贸n Iniciar Juego -->
        <button
          (click)="startGame()"
          [disabled]="!canStartGame || isLoading"
          pButton
          type="button"
          label=" Iniciar Juego"
          class="p-button-success"
          [loading]="isLoading"
        ></button>

        <!-- Bot贸n Mostrar QR -->
        <button
          (click)="showQRCode()"
          pButton
          type="button"
          label=" Mostrar QR"
          class="p-button-info"
        ></button>
      </div>
    </p-card>

    <!-- Tarjeta de Jugadores -->
    <p-card class="mb-4">
      <ng-template pTemplate="header">
        <h3 class="text-xl font-bold">Jugadores en la Sala</h3>
      </ng-template>

      <div *ngIf="playersCount === 0" class="text-center text-gray-500 py-8">
        <p> Esperando jugadores...</p>
      </div>

      <div *ngIf="playersCount > 0" class="space-y-2">
        <div
          *ngFor="let player of players"
          class="flex justify-between items-center bg-gray-100 p-3 rounded"
        >
          <div>
            <p class="font-medium">{{ player.name }}</p>
            <p class="text-sm text-gray-600">Score: {{ player.score }}</p>
          </div>
          <p-tag value=" Jugador" severity="info"></p-tag>
        </div>
      </div>
    </p-card>

    <!-- Dialog para QR -->
    <p-dialog
      [(visible)]="showQRDialog"
      header="C贸digo QR"
      [modal]="true"
      [style]="{ width: '50vw' }"
    >
      <div class="text-center">
        <img [src]="qrCodeUrl" alt="QR Code" class="inline" />
        <p class="mt-4 text-gray-600">
          Los jugadores pueden escanear este c贸digo para unirse a la sala
        </p>
        <p class="font-bold">{{ roomId }}</p>
      </div>
    </p-dialog>
  </div>
</div>

<!-- Toast para notificaciones -->
<p-toast></p-toast>